### 기본 istio에는 operator.yaml 파일이 존재하지 않음, 따라서 operator를 init 해주어야 함
istioctl operator init

### init 실행 후 IstioOperator 리소스 생성
kubectl apply -f - <<EOF
apiVersion: install.istio.io/v1alpha1
kind: IstioOperator
metadata:
  namespace: istio-system
  name: istio-control-plane
spec:
  profile: default
EOF

### 리소스 생성 확인
kubectl get istiooperator -n istio-system

### IstioOperator 파일 수정
kubectl edit istiooperator istio-control-plane -n istio-system

### 현재 설정들을 모두 istio-operator.yaml파일로 복사 -> 내용 수정이 필요할 때마다 apply 필요
kubectl get istiooperator istio-control-plane -n istio-system -o yaml > istio-operator.yaml

### 인증서 latency tracing을 위해 아래 코드들을 istio-operator.yaml파일에 추가
spec:
  profile: default 하단에 추가
  meshConfig:
      defaultConfig:
        proxyMetadata:
          ISTIO_META_CERT_SIGNING: "true"
          ISTIO_META_TLS_DEBUG: "1"
          ISTIO_META_ENABLE_CERT_METRICS: "true"
### 이후 적용
kubectl apply -f istio-operator.yaml
